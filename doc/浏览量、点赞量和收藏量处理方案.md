# 浏览量、点赞量和收藏量处理方案

## 浏览量方案

浏览量有两个概念：

- PV：每次页面被刷新都计数
- UV：同一用户在统计周期内只计一次

前台文章的浏览量属于 PV，后台统计分析数据适用于 UV，这里只处理 PV 情况

### 技术实现

采用 Redis 的 string 结构来存储浏览量，为了防止恶意刷浏览量，使用 Lua 脚本对新增浏览量做限流

浏览量出现的场景：

- **首页查询文章列表**：查询文章列表采用的是模糊统计，比如有1234个浏览量，只会显示1.2k，所以这里允许出现稍许数据不一致的偏差，就直接返回的是数据库中的浏览量

- **查询具体文章详细信息**：获取 Redis 中缓存的浏览量的数据，若数据不存在，就从数据库中获取，然后缓存在 Redis 中并设置有效期为7天

- **新增浏览量**：页面刷新通过 `redisTemplate.opsForValue().increment` 来实现自增，每次新增都会刷新 Redis Key 的有效期为7天（在自增前需要校验缓存是否过期，若不存在还需要加载缓存），此外用定时任务每隔1小时去更新数据库中文章的浏览量

## 点赞量和收藏量



